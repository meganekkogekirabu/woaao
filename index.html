<!DOCTYPE html>
<head>
    <title>woaao</title>
    <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>
    <dialog id="signup">
        <h3>Sign up</h3>
        <button class="close-dialog">x</button>
        <form id="signup-form" action="/" method="POST">
            <label for="username">username:</label>
            <input type="text" name="username">
            <br><br>
            <label for="password">password:</label>
            <input type="password" name="password">
            <br><br>
            <input type="submit" value="Submit">
        </form>
        <div id="response-status"></div>
    </dialog>
    <button data-dialog-target="signup">Sign up</button>
    <script>
        const response_status = document.getElementById("response-status");
        const signin_form = document.getElementById("signup-form");

        signin_form.addEventListener("submit", async (event) => {
            event.preventDefault();

            const formData = new FormData(signin_form);
            const username = formData.get("username");
            const password = formData.get("password");

            try {
                const response = await fetch("/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                    },
                    body: new URLSearchParams({ username, password }),
                });

                const data = await response.json();

                console.log(data.response);

                if (response.ok) {
                    response_status.textContent = data.response;
                } else {
                    response_status.textContent = `Error: ${data.error || data.response}`;
                }
            } catch (e) {
                console.error("Error while sending request:", e);
                response_status.textContent = "An error occurred during the request. Please try again later.";
            }
        });
        
        document.addEventListener("click", (event) => {
            const show_button = event.target.closest("[data-dialog-target]");
            const close_button = event.target.closest(".close-dialog");

            if (show_button) {
                const dialog_id = show_button.dataset.dialogTarget;
                const dialog = document.getElementById(dialog_id);
                if (dialog) {
                    dialog.showModal();
                }
            }

            if (close_button) {
                const dialog = close_button.closest("dialog");
                console.log(event.target)
                if (dialog) {
                    dialog.close();
                }
            }
        })
    </script>
</body>